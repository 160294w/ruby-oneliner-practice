<div align="center">

# ğŸ”„ Day 11: ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒã‚¹ã‚¿ãƒ¼

[![é›£æ˜“åº¦](https://img.shields.io/badge/é›£æ˜“åº¦-ğŸ”´%20ä¸Šç´š-red?style=flat-square)](#)
[![å®Ÿç”¨åº¦](https://img.shields.io/badge/å®Ÿç”¨åº¦-â­â­â­â­-yellow?style=flat-square)](#)
[![æ‰€è¦æ™‚é–“](https://img.shields.io/badge/æ‰€è¦æ™‚é–“-45åˆ†-blue?style=flat-square)](#)

</div>

---

## ğŸ¯ å®Ÿç”¨å ´é¢

**ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰æ–°ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã€ç•°ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒå¿…è¦ã€‚

**å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒç•°ãªã‚‹ã€ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒè¤‡é›‘ã€‚å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã§æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚

**è§£æ±º**: Rubyãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§å®‰å…¨ã‹ã¤é«˜é€Ÿãªãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼æ¤œè¨¼æ©Ÿèƒ½ä»˜ãï¼

## ğŸ“ èª²é¡Œ

ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ¢ãƒ€ãƒ³ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã€æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§å®Ÿç¾ã—ã¦ãã ã•ã„ã€‚

### ğŸ¯ æœŸå¾…ã™ã‚‹å‡¦ç†ä¾‹
```bash
# ãƒ¬ã‚¬ã‚·ãƒ¼CSVã‹ã‚‰æ–°å½¢å¼JSONã¸å¤‰æ›
legacy_users.csv â†’ users.json (æ¤œè¨¼ä»˜ã)

# å›ºå®šé•·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰CSVã¸å¤‰æ›
legacy_records.txt â†’ records.csv

# ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã¨æ­£è¦åŒ–
ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã®æ¤œå‡ºãƒ»ä¿®æ­£ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

# å·®åˆ†æ¤œå‡ºã¨ãƒãƒ¼ã‚¸
æ–°æ—§ãƒ‡ãƒ¼ã‚¿ã®æ¯”è¼ƒã€å·®åˆ†æŠ½å‡ºã€ãƒãƒ¼ã‚¸å‡¦ç†
```

## ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

| ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ | ç”¨é€” | é‡è¦åº¦ |
|-----------|------|--------|
| ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ | æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ | â­â­â­â­â­ |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | ä¾‹å¤–å‡¦ç† | â­â­â­â­â­ |
| ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ– | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆçµ±ä¸€ | â­â­â­â­ |
| ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç† | ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼ | â­â­â­â­ |

## ğŸš€ ãƒ¬ãƒ™ãƒ«åˆ¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸

### ğŸŸ¢ åŸºæœ¬ãƒ¬ãƒ™ãƒ«
å›ºå®šé•·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ‘ãƒ¼ã‚¹ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼š

```ruby
# ãƒ’ãƒ³ãƒˆ: ã“ã®æ§‹é€ ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„
File.readlines("sample_data/fixed_length.txt").each do |line|
  id = line[0..4].strip
  name = line[5..24].strip
  age = line[25..27].strip
  # ãƒ‡ãƒ¼ã‚¿å‡¦ç†
end
```

<details>
<summary>ğŸ’¡ åŸºæœ¬ãƒ¬ãƒ™ãƒ«ã®ãƒ’ãƒ³ãƒˆ</summary>

- å›ºå®šé•·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä½ç½®ã¨é•·ã•ãŒæ±ºã¾ã£ã¦ã„ã‚‹
- `String#[]` ã§éƒ¨åˆ†æ–‡å­—åˆ—ã‚’æŠ½å‡º
- `strip` ã§å‰å¾Œã®ç©ºç™½ã‚’é™¤å»
- CSVå½¢å¼ã§å‡ºåŠ›

</details>

### ğŸŸ¡ å¿œç”¨ãƒ¬ãƒ™ãƒ«

<details>
<summary><strong>1. ãƒ¬ã‚¬ã‚·ãƒ¼CSVã‹ã‚‰JSONã¸å¤‰æ›ï¼ˆæ¤œè¨¼ä»˜ãï¼‰</strong></summary>

```ruby
require 'csv'
require 'json'

# ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼é–¢æ•°
def valid_email?(email)
  email =~ /\A[\w+\-.]+@[a-z\d\-]+(\.[a-z\d\-]+)*\.[a-z]+\z/i
end

def valid_phone?(phone)
  phone =~ /\A\d{2,4}-\d{2,4}-\d{4}\z/
end

# å¤‰æ›å‡¦ç†
users = []
errors = []

CSV.foreach("sample_data/legacy_users.csv", headers: true) do |row|
  user = {
    id: row["user_id"].to_i,
    name: row["name"].strip,
    email: row["email"].strip.downcase,
    phone: row["phone"].gsub(/[^\d-]/, ''),
    age: row["age"].to_i,
    created_at: row["created_at"]
  }

  # æ¤œè¨¼
  errors << "Invalid email for user #{user[:id]}: #{user[:email]}" unless valid_email?(user[:email])
  errors << "Invalid phone for user #{user[:id]}: #{user[:phone]}" unless valid_phone?(user[:phone])
  errors << "Invalid age for user #{user[:id]}: #{user[:age]}" unless user[:age] > 0 && user[:age] < 150

  users << user if errors.empty?
end

# çµæœå‡ºåŠ›
File.write("output/users.json", JSON.pretty_generate(users))
File.write("output/errors.log", errors.join("\n")) if errors.any?

puts "å¤‰æ›å®Œäº†: #{users.size}ä»¶"
puts "ã‚¨ãƒ©ãƒ¼: #{errors.size}ä»¶" if errors.any?
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ©ãƒ¼åé›†ã€çµæœãƒ¬ãƒãƒ¼ãƒˆ

</details>

<details>
<summary><strong>2. å›ºå®šé•·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›</strong></summary>

```ruby
require 'csv'

# ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
FIELDS = [
  { name: :id, start: 0, length: 5 },
  { name: :name, start: 5, length: 20 },
  { name: :age, start: 25, length: 3 },
  { name: :email, start: 28, length: 30 },
  { name: :phone, start: 58, length: 13 }
]

records = File.readlines("sample_data/fixed_length.txt").map do |line|
  FIELDS.map do |field|
    value = line[field[:start], field[:length]].to_s.strip
    [field[:name], value]
  end.to_h
end

CSV.open("output/converted.csv", "w", headers: FIELDS.map { |f| f[:name] }, write_headers: true) do |csv|
  records.each { |record| csv << record.values }
end

puts "å¤‰æ›å®Œäº†: #{records.size}ä»¶"
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã®æ§‹é€ åŒ–ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é§†å‹•å‡¦ç†

</details>

<details>
<summary><strong>3. ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã¨æ­£è¦åŒ–</strong></summary>

```ruby
require 'csv'

# æ­£è¦åŒ–é–¢æ•°
def normalize_phone(phone)
  digits = phone.gsub(/\D/, '')
  case digits.length
  when 10
    "0#{digits[0..1]}-#{digits[2..5]}-#{digits[6..9]}"
  when 11
    "#{digits[0..2]}-#{digits[3..6]}-#{digits[7..10]}"
  else
    phone # ä¿®æ­£ä¸å¯ã®å ´åˆã¯å…ƒã®å€¤ã‚’è¿”ã™
  end
end

def normalize_name(name)
  name.strip.gsub(/\s+/, ' ').split.map(&:capitalize).join(' ')
end

# ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å‡¦ç†
cleaned = []
CSV.foreach("sample_data/dirty_data.csv", headers: true) do |row|
  cleaned << {
    name: normalize_name(row["name"]),
    email: row["email"].strip.downcase,
    phone: normalize_phone(row["phone"]),
    age: row["age"].to_i
  }
end

puts "ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°å®Œäº†: #{cleaned.size}ä»¶"
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**: ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–ã€è¤‡æ•°ã®å¤‰æ›ãƒ«ãƒ¼ãƒ«é©ç”¨

</details>

<details>
<summary><strong>4. å·®åˆ†æ¤œå‡ºã¨ãƒãƒ¼ã‚¸</strong></summary>

```ruby
require 'json'

# æ–°æ—§ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
old_data = JSON.parse(File.read("sample_data/old_users.json"))
new_data = JSON.parse(File.read("sample_data/new_users.json"))

old_ids = old_data.map { |u| u["id"] }
new_ids = new_data.map { |u| u["id"] }

# å·®åˆ†æ¤œå‡º
added = new_data.select { |u| !old_ids.include?(u["id"]) }
removed = old_data.select { |u| !new_ids.include?(u["id"]) }
updated = new_data.select do |nu|
  old_u = old_data.find { |ou| ou["id"] == nu["id"] }
  old_u && old_u != nu
end

puts "è¿½åŠ : #{added.size}ä»¶"
puts "å‰Šé™¤: #{removed.size}ä»¶"
puts "æ›´æ–°: #{updated.size}ä»¶"
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**: å·®åˆ†æŠ½å‡ºã€ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

</details>

### ğŸ”´ å®Ÿå‹™ãƒ¬ãƒ™ãƒ«

<details>
<summary><strong>åŒ…æ‹¬çš„ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚·ã‚¹ãƒ†ãƒ </strong></summary>

è¤‡æ•°ã®ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰æ–°ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ç§»è¡Œã‚’ã€æ¤œè¨¼ãƒ»ãƒ­ã‚®ãƒ³ã‚°ãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ä»˜ãã§å®Ÿè£…ã€‚

```ruby
require 'csv'
require 'json'
require 'time'
require 'fileutils'

class DataMigration
  attr_reader :stats

  def initialize(config = {})
    @config = config
    @stats = {
      total: 0,
      success: 0,
      errors: 0,
      warnings: 0,
      skipped: 0
    }
    @errors = []
    @warnings = []
  end

  def migrate_from_csv(input_file, output_file)
    puts "=== ãƒ‡ãƒ¼ã‚¿ç§»è¡Œé–‹å§‹ ==="
    puts "å…¥åŠ›: #{input_file}"
    puts "å‡ºåŠ›: #{output_file}"

    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
    create_backup(output_file) if File.exist?(output_file)

    records = []
    CSV.foreach(input_file, headers: true) do |row|
      @stats[:total] += 1

      begin
        record = transform_record(row)
        if validate_record(record)
          records << record
          @stats[:success] += 1
        else
          @stats[:skipped] += 1
        end
      rescue => e
        @errors << { row: @stats[:total], error: e.message }
        @stats[:errors] += 1
      end
    end

    # å‡ºåŠ›
    File.write(output_file, JSON.pretty_generate(records))

    # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    generate_report
  end

  private

  def transform_record(row)
    {
      id: row["id"].to_i,
      name: normalize_name(row["name"]),
      email: normalize_email(row["email"]),
      phone: normalize_phone(row["phone"]),
      age: row["age"].to_i,
      status: row["status"] || "active",
      created_at: parse_date(row["created_at"]),
      updated_at: Time.now.iso8601
    }
  end

  def validate_record(record)
    valid = true

    unless valid_email?(record[:email])
      @warnings << "Invalid email for ID #{record[:id]}: #{record[:email]}"
      @stats[:warnings] += 1
      valid = false
    end

    unless record[:age] > 0 && record[:age] < 150
      @warnings << "Invalid age for ID #{record[:id]}: #{record[:age]}"
      @stats[:warnings] += 1
      valid = false
    end

    valid
  end

  def normalize_name(name)
    return "" if name.nil?
    name.strip.gsub(/\s+/, ' ')
  end

  def normalize_email(email)
    return "" if email.nil?
    email.strip.downcase
  end

  def normalize_phone(phone)
    return "" if phone.nil?
    digits = phone.gsub(/\D/, '')

    case digits.length
    when 10
      "#{digits[0..2]}-#{digits[3..6]}-#{digits[7..9]}"
    when 11
      "#{digits[0..2]}-#{digits[3..6]}-#{digits[7..10]}"
    else
      phone
    end
  end

  def valid_email?(email)
    email =~ /\A[\w+\-.]+@[a-z\d\-]+(\.[a-z\d\-]+)*\.[a-z]+\z/i
  end

  def parse_date(date_str)
    Time.parse(date_str).iso8601
  rescue
    Time.now.iso8601
  end

  def create_backup(file)
    backup_name = "#{file}.backup.#{Time.now.strftime('%Y%m%d_%H%M%S')}"
    FileUtils.cp(file, backup_name)
    puts "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: #{backup_name}"
  end

  def generate_report
    puts "\n=== ç§»è¡Œå®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ ==="
    puts "ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: #{@stats[:total]}"
    puts "æˆåŠŸ: #{@stats[:success]} (#{success_rate}%)"
    puts "ã‚¨ãƒ©ãƒ¼: #{@stats[:errors]}"
    puts "è­¦å‘Š: #{@stats[:warnings]}"
    puts "ã‚¹ã‚­ãƒƒãƒ—: #{@stats[:skipped]}"

    if @errors.any?
      puts "\n=== ã‚¨ãƒ©ãƒ¼è©³ç´° ==="
      @errors.each { |err| puts "Row #{err[:row]}: #{err[:error]}" }
    end

    if @warnings.any?
      puts "\n=== è­¦å‘Šè©³ç´° ==="
      @warnings.first(10).each { |w| puts "- #{w}" }
      puts "(ä»–#{@warnings.size - 10}ä»¶)" if @warnings.size > 10
    end
  end

  def success_rate
    return 0 if @stats[:total] == 0
    ((@stats[:success].to_f / @stats[:total]) * 100).round(2)
  end
end

# å®Ÿè¡Œä¾‹
migration = DataMigration.new
migration.migrate_from_csv(
  "sample_data/legacy_users.csv",
  "output/migrated_users.json"
)
```

</details>

## ğŸ“Š å®Ÿéš›ã®æ¥­å‹™ã§ã®ä½¿ç”¨ä¾‹

- ğŸ”„ **ã‚·ã‚¹ãƒ†ãƒ ãƒªãƒ—ãƒ¬ãƒ¼ã‚¹** - æ—§ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰æ–°ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
- ğŸ“Š **ãƒ‡ãƒ¼ã‚¿çµ±åˆ** - è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®çµ±åˆãƒ»æ­£è¦åŒ–
- ğŸ§¹ **ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°** - ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã®æ¤œå‡ºãƒ»ä¿®æ­£ãƒ»å‰Šé™¤
- ğŸ“ˆ **ETLå‡¦ç†** - Extract, Transform, Load ã®è‡ªå‹•åŒ–
- ğŸ” **ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†** - ãƒ‡ãƒ¼ã‚¿å“è³ªã®ç¶™ç¶šçš„ãªç›£è¦–ã¨æ”¹å–„

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- âœ… åŸºæœ¬ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢ â†’ [Day 12: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](../day12_performance/problem.md)
- ğŸ”— é–¢é€£ã™ã‚‹å®Ÿç”¨ä¾‹ â†’ [å®Ÿä¸–ç•Œã§ã®ä½¿ç”¨ä¾‹](../../../resources/real_world_examples.md#ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ)

---

<div align="center">

[ğŸ  ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹](../../../README.md) | [ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹](hints.md) | [âœ… è§£ç­”ä¾‹ã‚’ç¢ºèª](solution.rb)

</div>
